ALTER TABLE `pms_voucher_dr_cr_note_dtl` ADD `date_of_issue` DATE NOT NULL AFTER `default_date`;
ALTER TABLE pms_account_master ADD `rate_of_depreciation` text NOT NULL DEFAULT '\'0\'' COMMENT 'non_current assests sungroup tangiable assets then value will be set';
ALTER TABLE `pms_stock` ADD `product_valuation_qty` TEXT NOT NULL COMMENT 'reflect from valuation report ' AFTER `stock_minimum_stock_reminder`, ADD `product_valuation_rate` TEXT NOT NULL COMMENT 'reflect from valuation report' AFTER `product_valuation_qty`, ADD `product_valuation_amt` TEXT NOT NULL COMMENT 'reflect from valuation report' AFTER `product_valuation_rate`, ADD `valuation_close_qty` TEXT NOT NULL COMMENT 'reflect from valuation report' AFTER `product_valuation_amt`, ADD `valuation_close_rate` TEXT NOT NULL COMMENT 'reflect from valuation report' AFTER `valuation_close_qty`, ADD `valuation_close_amt` TEXT NOT NULL COMMENT 'reflect from valuation report' AFTER `valuation_close_rate`;
ALTER TABLE pms_account_master ADD   `natural_assets` text NOT NULL DEFAULT '\' \'' COMMENT 'noncurrent assets subgroup tangiable assets valuw will be set';
ALTER TABLE pms_account_master ADD `UCID` varchar(50) NOT NULL;
ALTER TABLE `pms_stock` ADD `stock_expiry_date` date DEFAULT NULL;
ALTER TABLE `pms_stock` ADD `stock_batch` varchar(50) NOT NULL;
ALTER TABLE pms_voucher_dr_cr_note_dtl ADD `date_of_issue` date DEFAULT NULL;
COMMIT;

CREATE TABLE IF NOT EXIST `pms_notification_table` (
 `notif_auto_id` int(11) NOT NULL,
 `company_ucid` text NOT NULL,
 `ca_ucid` text NOT NULL,
 `notif_file_link` text NOT NULL,
 `notif_backupfile_link` text NOT NULL,
 `notif_gst_status` int(11) NOT NULL DEFAULT 1 COMMENT '1-gst created and 2-gst filed',
 `notif_data_load_status` int(11) NOT NULL DEFAULT 1 COMMENT '1-load data and 2-send to company',
 `default_date` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

SELECT salemst.seller_name as recename, salemst.gstin as gstno, salemst.s_state as statename, `place_of_supply` as pos, salemst.invoice_no no, salemst.invoice_date idate, `total_cost` as invoice_value, saledtl.hsn_code as hsncode, saledtl.product_desc goodservice, saledtl.tax_val taxval, saledtl.qty qauty, saledtl.uom unit, saledtl.igst_rate igstrate, saledtl.igst_amt igstamt, saledtl.cgst_rate cgstrate, saledtl.cgst_amt cgstamt, saledtl.sgst_rate sgstrate, saledtl.sgst_amount sgstamt, 0 cessrate, 0 cessamt, salemst.`reverse_charge` revcharge, '' ecomoperator, 0 comp_gstin, 0 exporttype, 0 shipbillno, 0 shipbilldate, 0 portcode, `sale_invoice_type` regular, '' itemtype FROM `pms_sale_invoice_mst` as salemst LEFT JOIN pms_sale_invoice_dtl AS saledtl ON salemst.sale_mst_id = saledtl.reference_id  where salemst.invoice_date between '" + FromDateId + "' and '" + ToDateId + "'";
SELECT drcrmst.bill_party_name recename, drcrmst.bill_party_gstin gstno, drcrmst.bill_party_state statename, drcrmst.bill_party_address pos, drcrmst.note_type type, drcrmst.document_no as drcrditno, drcrmst.date_of_issue drcrdate, drcrmst.remarks reason, drcrdtl.hsn_code hsn, drcrdtl.product_name goodservice, drcrdtl.quantity qauty, drcrdtl.uom unit, drcrmst.against_invoice origino, drcrmst.date_of_invoice origidate, 0 diffvalue, drcrdtl.igst_rate igstrate, drcrdtl.igst_amount igstamount, drcrdtl.cgst_rate cgstrate, drcrdtl.cgst_amount cgstamount, drcrdtl.sgst_rate sgstrate, drcrdtl.sgst_amount sgstamount, 0 cessrate, 0 cessamount, '' revcharge, 0 pregst FROM pms_voucher_dr_cr_note_mst drcrmst RIGHT JOIN pms_voucher_dr_cr_note_dtl drcrdtl ON drcrdtl.refrance_id = drcrmst.dr_cr_Id WHERE drcrmst.note_type = 'credit' and drcrmst.status = 0 and drcrmst.date_of_issue between '" + FromDateId + "' and '" + ToDateId + "'";

SELECT t1.product_name,t1.qty as quantity, t1.value, t1.month, t1.monthname, t1.static_type from    (SELECT invoice_type static_type, monthname(`invoice_date`) monthname, month(`invoice_date`) month, sum(pms_sale_invoice_dtl.qty) qty, sum(pms_sale_invoice_dtl.tax_val) value,product_desc product_name FROM `pms_sale_invoice_dtl` where status != 2 and invoice_date<='" + selected_date + "' group by monthname(`invoice_date`),product_desc UNION SELECT invoice_type type, monthname(`invoice_date`) monthname, month(`invoice_date`) month, sum(pms_purchase_invoice_dtl.qty) qty, sum(pms_purchase_invoice_dtl.tax_val) value, product_desc product_name FROM `pms_purchase_invoice_dtl`where invoice_type = 'purchase' and status != 2 and invoice_date <= '"+selected_date+"' group by monthname(invoice_date), product_desc UNION select note_type static_type, monthname(pms_voucher_dr_cr_note_dtl.date_of_issue) monthname, month(pms_voucher_dr_cr_note_dtl.date_of_issue) month, sum(pms_voucher_dr_cr_note_dtl.quantity) qty, sum(pms_voucher_dr_cr_note_dtl.tax_value) value, pms_voucher_dr_cr_note_dtl.product_name from pms_voucher_dr_cr_note_dtl right join pms_voucher_dr_cr_note_mst on refrance_id = dr_cr_Id where note_type = 'purchaseReturn' and pms_voucher_dr_cr_note_dtl.status != 2 and pms_voucher_dr_cr_note_dtl.date_of_issue <= '"+selected_date+"'  group by monthname(pms_voucher_dr_cr_note_dtl.date_of_issue), pms_voucher_dr_cr_note_dtl.product_name UNION select note_type static_type, monthname(pms_voucher_dr_cr_note_dtl.date_of_issue) monthname, month(pms_voucher_dr_cr_note_dtl.date_of_issue) month, sum(pms_voucher_dr_cr_note_dtl.quantity) qty, sum(pms_voucher_dr_cr_note_dtl.tax_value) value, pms_voucher_dr_cr_note_dtl.product_name from pms_voucher_dr_cr_note_dtl right join pms_voucher_dr_cr_note_mst on refrance_id = dr_cr_Id where note_type = 'saleReturn' and pms_voucher_dr_cr_note_dtl.status != 2  and pms_voucher_dr_cr_note_dtl.date_of_issue <= '"+selected_date+"' group by monthname(pms_voucher_dr_cr_note_dtl.date_of_issue), pms_voucher_dr_cr_note_dtl.product_name) t1 where t1.month >0
SELECT t1.product_name,t1.qty as quantity, t1.value, t1.month, t1.monthname, t1.static_type,t1.batch from    (SELECT invoice_type static_type, monthname(`invoice_date`) monthname, month(`invoice_date`) month, sum(pms_sale_invoice_dtl.qty) qty, sum(pms_sale_invoice_dtl.tax_val) value, product_desc product_name, batch FROM `pms_sale_invoice_dtl` where status != 2 and invoice_date <='" + selected_date + "' group by monthname(`invoice_date`), product_desc, batch UNION SELECT invoice_type type, monthname(`invoice_date`) monthname, month(`invoice_date`) month, sum(pms_purchase_invoice_dtl.qty) qty, sum(pms_purchase_invoice_dtl.tax_val) value, product_desc product_name, batch FROM `pms_purchase_invoice_dtl`where invoice_type = 'purchase' and status != 2 and invoice_date <='" + selected_date + "' group by monthname(invoice_date), product_desc, batch UNION select note_type static_type, monthname(pms_voucher_dr_cr_note_dtl.date_of_issue) monthname, month(pms_voucher_dr_cr_note_dtl.date_of_issue) month, sum(pms_voucher_dr_cr_note_dtl.quantity) qty, sum(pms_voucher_dr_cr_note_dtl.tax_value) value, pms_voucher_dr_cr_note_dtl.product_name, batch from pms_voucher_dr_cr_note_dtl right join pms_voucher_dr_cr_note_mst on refrance_id = dr_cr_Id where note_type = 'purchaseReturn' and pms_voucher_dr_cr_note_dtl.status != 2 and pms_voucher_dr_cr_note_dtl.date_of_issue <='" + selected_date + "'  group by monthname(pms_voucher_dr_cr_note_dtl.date_of_issue), pms_voucher_dr_cr_note_dtl.product_name, batch UNION select note_type static_type, monthname(pms_voucher_dr_cr_note_dtl.date_of_issue) monthname, month(pms_voucher_dr_cr_note_dtl.date_of_issue) month, sum(pms_voucher_dr_cr_note_dtl.quantity) qty, sum(pms_voucher_dr_cr_note_dtl.tax_value) value, pms_voucher_dr_cr_note_dtl.product_name, batch from pms_voucher_dr_cr_note_dtl right join pms_voucher_dr_cr_note_mst on refrance_id = dr_cr_Id where note_type = 'saleReturn' and pms_voucher_dr_cr_note_dtl.status != 2  and pms_voucher_dr_cr_note_dtl.date_of_issue <='" + selected_date + "' group by monthname(pms_voucher_dr_cr_note_dtl.date_of_issue), pms_voucher_dr_cr_note_dtl.product_name, batch) t1 where t1.month > 0
SELECT t1.product_name,t1.qty as quantity, t1.value, t1.month, t1.monthname, t1.static_type,t1.batch,t1.expiry_date from    (SELECT invoice_type static_type, monthname(`invoice_date`) monthname, month(`invoice_date`) month, sum(pms_sale_invoice_dtl.qty) qty, sum(pms_sale_invoice_dtl.tax_val) value,product_desc product_name,batch,expiry_date FROM `pms_sale_invoice_dtl` where status != 2 and invoice_date<='" + selected_date + "' group by monthname(`invoice_date`),product_desc,batch,expiry_date UNION SELECT invoice_type type, monthname(`invoice_date`) monthname, month(`invoice_date`) month, sum(pms_purchase_invoice_dtl.qty) qty, sum(pms_purchase_invoice_dtl.tax_val) value, product_desc product_name,batch,expiry_date FROM `pms_purchase_invoice_dtl`where invoice_type = 'purchase' and status != 2 and invoice_date <= '" + selected_date + "' group by monthname(invoice_date), product_desc,batch,expiry_date UNION select note_type static_type, monthname(pms_voucher_dr_cr_note_dtl.date_of_issue) monthname, month(pms_voucher_dr_cr_note_dtl.date_of_issue) month, sum(pms_voucher_dr_cr_note_dtl.quantity) qty, sum(pms_voucher_dr_cr_note_dtl.tax_value) value, pms_voucher_dr_cr_note_dtl.product_name, batch,expiry_date from pms_voucher_dr_cr_note_dtl right join pms_voucher_dr_cr_note_mst on refrance_id = dr_cr_Id where note_type = 'purchaseReturn' and pms_voucher_dr_cr_note_dtl.status != 2 and pms_voucher_dr_cr_note_dtl.date_of_issue <= '" + selected_date + "'  group by monthname(pms_voucher_dr_cr_note_dtl.date_of_issue), pms_voucher_dr_cr_note_dtl.product_name,batch,expiry_date UNION select note_type static_type, monthname(pms_voucher_dr_cr_note_dtl.date_of_issue) monthname, month(pms_voucher_dr_cr_note_dtl.date_of_issue) month, sum(pms_voucher_dr_cr_note_dtl.quantity) qty, sum(pms_voucher_dr_cr_note_dtl.tax_value) value, pms_voucher_dr_cr_note_dtl.product_name,batch,expiry_date from pms_voucher_dr_cr_note_dtl right join pms_voucher_dr_cr_note_mst on refrance_id = dr_cr_Id where note_type = 'saleReturn' and pms_voucher_dr_cr_note_dtl.status != 2  and pms_voucher_dr_cr_note_dtl.date_of_issue <= '" + selected_date + "' group by monthname(pms_voucher_dr_cr_note_dtl.date_of_issue), pms_voucher_dr_cr_note_dtl.product_name,batch,expiry_date) t1 where t1.month >0

SELECT t1.product_name,t1.qty as quantity, t1.value, t1.month, t1.monthname, t1.static_type,t1.batch from    (SELECT invoice_type static_type, monthname(`invoice_date`) monthname, month(`invoice_date`) month, sum(pms_sale_invoice_dtl.qty) qty, sum(pms_sale_invoice_dtl.tax_val) value, product_desc product_name, batch FROM `pms_sale_invoice_dtl` where status != 2 and invoice_date <='" + selected_date + "' group by monthname(`invoice_date`), product_desc, batch UNION SELECT invoice_type type, monthname(`invoice_date`) monthname, month(`invoice_date`) month, sum(pms_purchase_invoice_dtl.qty) qty, sum(pms_purchase_invoice_dtl.tax_val) value, product_desc product_name, batch FROM `pms_purchase_invoice_dtl`where invoice_type = 'purchase' and status != 2 and invoice_date <='" + selected_date + "' group by monthname(invoice_date), product_desc, batch UNION select note_type static_type, monthname(pms_voucher_dr_cr_note_dtl.date_of_issue) monthname, month(pms_voucher_dr_cr_note_dtl.date_of_issue) month, sum(pms_voucher_dr_cr_note_dtl.quantity) qty, sum(pms_voucher_dr_cr_note_dtl.tax_value) value, pms_voucher_dr_cr_note_dtl.product_name, batch from pms_voucher_dr_cr_note_dtl right join pms_voucher_dr_cr_note_mst on refrance_id = dr_cr_Id where note_type = 'purchaseReturn' and pms_voucher_dr_cr_note_dtl.status != 2 and pms_voucher_dr_cr_note_dtl.date_of_issue <='" + selected_date + "'  group by monthname(pms_voucher_dr_cr_note_dtl.date_of_issue), pms_voucher_dr_cr_note_dtl.product_name, batch UNION select note_type static_type, monthname(pms_voucher_dr_cr_note_dtl.date_of_issue) monthname, month(pms_voucher_dr_cr_note_dtl.date_of_issue) month, sum(pms_voucher_dr_cr_note_dtl.quantity) qty, sum(pms_voucher_dr_cr_note_dtl.tax_value) value, pms_voucher_dr_cr_note_dtl.product_name, batch from pms_voucher_dr_cr_note_dtl right join pms_voucher_dr_cr_note_mst on refrance_id = dr_cr_Id where note_type = 'saleReturn' and pms_voucher_dr_cr_note_dtl.status != 2  and pms_voucher_dr_cr_note_dtl.date_of_issue <='" + selected_date + "' group by monthname(pms_voucher_dr_cr_note_dtl.date_of_issue), pms_voucher_dr_cr_note_dtl.product_name, batch) t1 where t1.month > 0

ALTER TABLE `pms_expenses_voucher_mst` ADD `exp_invoice_no` VARCHAR(16) NOT NULL AFTER `exp_voucher_no`;
ALTER TABLE `pms_expenses_voucher_mst` ADD `exp_invoice_IRN` VARCHAR(16) NOT NULL AFTER `exp_invoice_no`;
ALTER TABLE `pms_expenses_voucher_mst` ADD `manual_id` INT NOT NULL AFTER `default_date`;

update pms_sale_invoice_dtl,pms_sale_invoice_mst set pms_sale_invoice_dtl.invoice_date=pms_sale_invoice_mst.invoice_date WHERE pms_sale_invoice_dtl.reference_id=pms_sale_invoice_mst.sale_mst_id
